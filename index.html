<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Anime Generator — Compare Mode</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --glass: rgba(255,255,255,0.12);
    --glass-2: rgba(255,255,255,0.08);
    --accent: #00c6ff;
    --accent-2: #0072ff;
  }
  body {
    margin:0; padding:0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg,#0f1724,#243b55);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .card {
    width: 920px;
    max-width: 95%;
    border-radius: 14px;
    padding: 22px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    box-shadow: 0 12px 30px rgba(2,6,23,0.6);
    color: white;
  }
  .header {
    display:flex; align-items:center; justify-content:space-between;
    gap: 12px;
  }
  h1 { margin:0; font-size:20px; font-weight:600; }
  .controls { display:flex; gap:10px; align-items:center; }
  button {
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    border: none; padding:10px 16px; border-radius:10px; color:white; cursor:pointer;
    font-weight:600;
  }
  button.ghost {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .grid {
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    margin-top:16px;
  }
  .panel {
    background: var(--glass);
    border-radius: 12px;
    padding: 10px;
    min-height: 320px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
  }
  .panel h3 { margin:8px 0; font-size:14px; font-weight:600; color:#e6eefc; }
  .panel img {
    width: 100%;
    height: 240px;
    object-fit:cover;
    border-radius: 8px;
    border: 2px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.02);
  }
  .meta {
    margin-top:8px;
    width:100%;
    display:flex; justify-content:space-between; font-size:13px;
  }

  .info {
    margin-top:14px; display:flex; gap:12px; align-items:center; justify-content:space-between;
  }
  .info .left { font-size:13px; color: #dbeafe; }
  .info .right { text-align:right; font-size:13px; color:#c7f0ff; }

  .loader {
    width:44px; height:44px; border-radius:50%;
    border:5px solid rgba(255,255,255,0.08);
    border-top:5px solid rgba(255,255,255,0.95);
    animation: spin 1s linear infinite; margin-top:18px;
    display:none;
  }
  @keyframes spin { 100%{ transform:rotate(360deg); } }

  .metrics {
    margin-top:14px; display:flex; gap:8px; align-items:center; justify-content:space-between;
  }

  .progress {
    height:12px; background:var(--glass-2); border-radius:8px; overflow:hidden;
    width: 220px;
  }
  .progress .bar {
    height:100%; width:0%; background: linear-gradient(90deg,#7afcff,#0072ff);
  }

  .small { font-size:13px; color:#cfeffd; }

  @media (max-width:1000px){
    .grid { grid-template-columns: 1fr; }
    .panel img { height: 200px; }
  }
</style>
</head>
<body>
  <div class="card">
    <div class="header">
      <h1>Anime Face Generator — Compare Mode</h1>
      <div class="controls">
        <button onclick="generateOnly()">Generate</button>
        <button class="ghost" onclick="compare()">Compare with random original</button>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h3>Original Image</h3>
        <img id="origImg" src="" alt="Original image (from dataset)">
        <div class="meta"><span id="origName" class="small">filename: —</span><span class="small" id="origRes">res: —</span></div>
      </div>

      <div class="panel">
        <h3>Generated Image</h3>
        <img id="genImg" src="" alt="Generated image">
        <div class="meta"><span class="small">model: <b id="modelName">—</b></span><span class="small" id="genRes">res: —</span></div>
        <div id="loaderGen" class="loader"></div>
      </div>

      <div class="panel">
        <h3>Difference (abs)</h3>
        <img id="diffImg" src="" alt="Difference">
        <div class="meta"><span class="small">gen time: <b id="genTime">—</b>s</span><span class="small">channels: <b id="channels">—</b></span></div>
      </div>
    </div>

    <div class="info">
      <div class="left">
        <div class="metrics">
          <div><span class="small">Accuracy:</span> <b id="accText">—</b></div>
          <div style="margin-left:12px;">
            <div class="progress"><div id="accBar" class="bar"></div></div>
          </div>
        </div>
        <div style="margin-top:8px;" class="small">
          <span>PSNR: <b id="psnr">—</b> dB</span> &nbsp; • &nbsp;
          <span>SSIM: <b id="ssim">—</b></span>
        </div>
      </div>

      <div class="right">
        <div class="small">Click "Compare" to pick a random original from your dataset folder and compare it with a generated sample.</div>
      </div>
    </div>
  </div>

<script>
const API_ROOT = "http://127.0.0.1:5000";

function showLoader(show=true) {
  document.getElementById("loaderGen").style.display = show ? "block" : "none";
}

function setDefaults() {
  document.getElementById("origImg").src = "";
  document.getElementById("genImg").src = "";
  document.getElementById("diffImg").src = "";
  document.getElementById("origName").innerText = "filename: —";
  document.getElementById("origRes").innerText = "res: —";
  document.getElementById("modelName").innerText = "—";
  document.getElementById("genRes").innerText = "res: —";
  document.getElementById("genTime").innerText = "—";
  document.getElementById("channels").innerText = "—";
  document.getElementById("accText").innerText = "—";
  document.getElementById("psnr").innerText = "—";
  document.getElementById("ssim").innerText = "—";
  document.getElementById("accBar").style.width = "0%";
}
setDefaults();

async function generateOnly() {
  setDefaults();
  showLoader(true);
  try {
    const res = await fetch(API_ROOT + "/generate");
    const data = await res.json();
    document.getElementById("genImg").src = "data:image/png;base64," + data.image;
    document.getElementById("modelName").innerText = data.model_name || "—";
    document.getElementById("genRes").innerText = data.resolution || "—";
    document.getElementById("genTime").innerText = data.generation_time || "—";
    document.getElementById("channels").innerText = data.channels || "—";
  } catch (err) {
    console.error(err);
    alert("Error generating image. See console.");
  } finally {
    showLoader(false);
  }
}

async function compare() {
  setDefaults();
  showLoader(true);
  try {
    const res = await fetch(API_ROOT + "/compare");
    const data = await res.json();
    if (data.error) { alert(data.error); showLoader(false); return; }

    document.getElementById("origImg").src = "data:image/png;base64," + data.original_image;
    document.getElementById("genImg").src = "data:image/png;base64," + data.generated_image;
    document.getElementById("diffImg").src = "data:image/png;base64," + data.diff_image;

    document.getElementById("origName").innerText = "filename: " + (data.chosen_filename || "—");
    document.getElementById("origRes").innerText = "res: " + (data.resolution || "—");
    document.getElementById("modelName").innerText = data.model_name || "—";
    document.getElementById("genRes").innerText = data.resolution || "—";
    document.getElementById("genTime").innerText = data.generation_time || "—";
    document.getElementById("channels").innerText = data.channels || "—";

    const metrics = data.metrics || {};
    const acc = metrics.accuracy_percent || 0;
    document.getElementById("accText").innerText = acc.toFixed(3) + " %";
    document.getElementById("accBar").style.width = Math.min(100, Math.max(0, acc)) + "%";
    document.getElementById("psnr").innerText = (metrics.psnr_db || "—");
    document.getElementById("ssim").innerText = (metrics.ssim || "—");
  } catch (err) {
    console.error(err);
    alert("Error comparing images. See console.");
  } finally {
    showLoader(false);
  }
}
</script>
</body>
</html>
